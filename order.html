<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÙØ±Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¯ÙˆØ±Ù‡</title>
  <link rel="icon" href="https://framerusercontent.com/images/WaE9y1q8u84RBhVkrUOim42h24I.png" />
  <link rel="stylesheet" href="index.css" />
  <style>
    :root { --lp-primary:#0d6efd; --lp-success:#00ff87; --lp-danger:#ff5e5e; }
    body { background: radial-gradient(1000px 600px at 70% 30%, rgba(0,255,135,0.08), transparent 60%),
                     radial-gradient(800px 500px at 20% 70%, rgba(96,239,255,0.08), transparent 60%),
                     #0b3a2b; }
    .checkout-wrap { max-width: 980px; margin: 40px auto; padding: 0 1rem; }
    .top-banner { background: #e74c3c; color:#fff; border-radius:14px; box-shadow:0 16px 40px rgba(0,0,0,.35); padding: 16px 20px; display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .top-banner .left { display:flex; align-items:center; gap:10px; font-family:'EstedadBold'; }
    .badge { background: rgba(255,255,255,.15); border-radius:999px; padding:8px 12px; display:inline-flex; align-items:center; gap:8px; }
    .pill { background:#ffb199; color:#581c0c; font-family:'EstedadBold'; border-radius:999px; padding:8px 12px; }
    .tabs { background:#fff; border-radius:10px; overflow:hidden; margin-top:16px; }
    .tab-headers { display:grid; grid-template-columns: 1fr 1fr; border-bottom:2px solid #0d6efd; }
    .tab-headers .tab { padding:10px 12px; text-align:center; font-family:'EstedadBold'; background:#f7f9fc; }
    .tab-headers .tab.active { color:#0d6efd; }
    .form-card { background:#fff; border-radius:12px; padding:18px; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
    .form-row { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .form-group { margin:10px 0; }
    .form-group label { display:block; margin-bottom:6px; color:#333; font-family:'EstedadBold'; }
    .form-group input { width:100%; border:1px solid #d9d9d9; border-radius:8px; padding:12px; font-size:1rem; }
    .form-actions { margin-top:18px; }
    .submit-btn { width:100%; background:#0d6efd; color:#fff; border:none; border-radius:10px; padding:14px; font-size:1.05rem; font-family:'EstedadBold'; cursor:pointer; }
    .submit-btn:disabled { opacity:.6; cursor:not-allowed; }
    .hint { color:#666; text-align:center; margin-top:8px; font-size:.9rem; }
    .status { margin-top:12px; padding:10px; border-radius:8px; display:none; }
    .status.error { display:block; background:#ffecec; color:#b00020; }
    .status.success { display:block; background:#e7fff3; color:#0a5230; }
  </style>
</head>
<body style="font-family: 'EstedadRegular';">
  <div class="checkout-wrap">
    <div class="top-banner" aria-label="Ø§Ø·Ù„Ø§Ø¹ÛŒÙ‡ Ø¸Ø±ÙÛŒØª">
      <div class="left">
        <span>âš ï¸ Ø¸Ø±ÙÛŒØª Ù…Ø­Ø¯ÙˆØ¯: ÙÙ‚Ø· Û²Û°Û° Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø§ÛŒÙ† Ù…Ø§Ù‡!</span>
        <span class="badge">ğŸ”¥ <span id="spots-left">193</span> Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡</span>
        <span class="badge">âš¡ï¸ 7 Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø§Ù…Ø±ÙˆØ² Ø±Ø²Ø±Ùˆ Ø´Ø¯</span>
      </div>
      <div class="pill" id="base-url-pill" title="Base URL">Base URL</div>
    </div>

    <div class="tabs" role="tablist">
      <div class="tab-headers">
        <div class="tab active">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø´Ù…Ø§</div>
        <div class="tab">Ù¾Ø±Ø¯Ø§Ø®Øª</div>
      </div>
      <div class="form-card" role="tabpanel" aria-labelledby="Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø´Ù…Ø§">
        <form id="order-form" novalidate>
          <input type="hidden" id="course_variant_id" />
          <div class="form-row">
            <div class="form-group">
              <label for="first_name">Ù†Ø§Ù…</label>
              <input id="first_name" name="first_name" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÛŒ" required />
            </div>
            <div class="form-group">
              <label for="last_name">Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
              <input id="last_name" name="last_name" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø­Ù…Ø¯ÛŒ" required />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="email">Ø§ÛŒÙ…ÛŒÙ„</label>
              <input id="email" name="email" type="email" placeholder="ali@example.com" />
            </div>
            <div class="form-group">
              <label for="mobile_number">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</label>
              <input id="mobile_number" name="mobile_number" inputmode="tel" placeholder="09123456789" />
            </div>
          </div>
          <div class="form-group">
            <label for="discount_code">Ú©Ø¯ ØªØ®ÙÛŒÙ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
            <input id="discount_code" name="discount_code" placeholder="Ù…Ø«Ø§Ù„: AOC50" />
          </div>
          <div class="form-actions">
            <button type="submit" class="submit-btn" id="submitBtn">Ø§Ø¯Ø§Ù…Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
            <p class="hint">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ù†Ø²Ø¯ Ù…Ø§ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.</p>
            <div class="status" id="status"></div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submitBtn');

    // Base URL configuration
    const urlParams = new URLSearchParams(window.location.search);
    const paramBase = urlParams.get('baseUrl');
    if (paramBase) localStorage.setItem('lp_base_url', paramBase);
    const BASE_URL = localStorage.getItem('lp_base_url') || '';
    document.getElementById('base-url-pill').textContent = BASE_URL ? BASE_URL : 'Base URL: ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡';

    // Get course variant id from query or default
    const courseId = parseInt(urlParams.get('course_variant_id') || '123', 10);
    document.getElementById('course_variant_id').value = courseId;

    function showStatus(text, type) {
      statusEl.textContent = text;
      statusEl.className = 'status ' + type;
    }

    function validateForm(values) {
      const errors = [];
      if (!values.first_name?.trim()) errors.push('Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      if (!values.last_name?.trim()) errors.push('Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      const hasEmail = !!values.email?.trim();
      const hasMobile = !!values.mobile_number?.trim();
      if (!hasEmail && !hasMobile) errors.push('ÛŒÚ©ÛŒ Ø§Ø² Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      if (hasEmail && !/^\S+@\S+\.\S+$/.test(values.email)) errors.push('Ø§ÛŒÙ…ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
      if (hasMobile && !/^\d{10,}$/.test(values.mobile_number.replace(/\D/g,''))) errors.push('Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
      return errors;
    }

    document.getElementById('order-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const values = {
        course_variant_id: courseId,
        first_name: document.getElementById('first_name').value.trim(),
        last_name: document.getElementById('last_name').value.trim(),
        email: document.getElementById('email').value.trim(),
        mobile_number: document.getElementById('mobile_number').value.trim(),
      };
      const discountCode = document.getElementById('discount_code').value.trim();
      if (discountCode) values.discount_code = discountCode; // Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø§Ú¯Ø± API Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ù†Ø¯

      const errs = validateForm(values);
      if (errs.length) { showStatus(errs.join(' â€” '), 'error'); return; }
      if (!BASE_URL) { showStatus('Base URL ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. ?baseUrl=... Ø±Ø§ Ø¨Ù‡ Ø¢Ø¯Ø±Ø³ ØµÙØ­Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯.', 'error'); return; }

      submitBtn.disabled = true; showStatus('Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª...', 'success');
      try {
        const res = await fetch(`${BASE_URL}/api/order/landing-page-order/`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(values)
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
        showStatus('Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª...', 'success');
        // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ù‡ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ø¯Ø§ÛŒØª Ú©Ù†ÛŒØ¯
        // window.location.href = `${BASE_URL}/payment?order_id=${data.id || ''}`;
      } catch (err) {
        showStatus(err.message, 'error');
      } finally { submitBtn.disabled = false; }
    });
  </script>
</body>
</html>

